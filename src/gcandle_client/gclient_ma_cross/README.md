# gclient_ma_cross 示例策略
此示例展示一个最简单的双均线策略的实现，全部代码不到60行，可以对任意时间区间的全部A股数据进行回测。

## 策略思路：
基本指标为日K线20天和60天均线，买入条件是短均线上穿长均线（命名为金叉ma_jc），下穿（命名为死叉ma_sc）则卖出。


## 实现指标计算和选股
首先创建一个文件ma_cross.py, 创建函数calc_ma_cross，参数data为pandas dataframe，此为日k线数据。
你暂时不需要想这个数据如何得来，只需知道，data为某一只股票的日k线数据，有几个列：open, close, low, high, vol, amount, 
日期（date）和股票代码（code）则是dataframe的index。
此函数计算上述均线的值，添加为新列。
重要的是返回值，应该返回策略买卖时需要的那些行，本例中，因为买入卖出都是一个指标所明确，所以直接返回ma_jc或ma_sc为True的行即可。
如果计算结果是没有这样的行，则返回None。

函数完成后，我们需要读取日线数据，对每一只股票数据调用一次这个函数，并把过滤出的股票存入数据库，以便后续回测调优。
这一切工作都不需要你写代码实现，只需要创建一个类型为MasterIndicatorService的类，第一个参数为主指标名，对现在这个简单示例，可以随意取名。
第二个参数就是上面创建的函数，然后调用这个对象的recreate_for_all_codes(start, end)方法，指定起止日期。甚至连读取股票代码都不需要。
上述API的设计基于一个事实，对于一个成熟的策略，我们需要对全市场的数据进行回测验证，来确保策略的有效性。
当然，在策略的具体实现中，你可以用任意的方法去过滤掉一些股票，但重要的是，你除了关心你的策略实现，不需要写任何额外的重复代码。

指标计算完成后，数据库中就有了待回测的股票及其指标，存在<name>_backtest 集合中。name是刚才指定的主指标名称。
现在实现回测。

## 实现回测
创建一个新文件ma_cross_backtest.py。首先考虑买入，我们应该只需要指定买入的条件，以及买入的价格。所以写出对应的两个函数。
final_buy_filter_on_buy_day 和 my_price_func，参数都是某一天的数据，这里和上述指标计算时的参数不同，因为这两个函数是回测时以天为单位调用。
买入策略为类型是BuyStrategy的对象，把上述两个函数设置到对应需要的属性即可。

然后考虑卖出，同样是一个条件和收盘价。条件函数为sell_on_sc，这个实现稍有不同，按代码所示创建一个对象即为卖出的策略。

回测的数据，只需引入ma_cross.py中定义的MA_CROSS_SERVICE对象，调用接口即可全部读出。

最后，回测类为DayBarBacktest，创建一个对象，把上述数据，买卖策略对象都设置好，就可以调用run方法开始回测了。